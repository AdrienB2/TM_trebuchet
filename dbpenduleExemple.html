<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <script src = "https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Pendule à deux degrés de liberté</title>
  </head>



  <body>
  <form id="set_variables_form">
    Masse 1 :<input id=mass1 size=20 value="10"> Masse 2 :<input size=20 id=mass2 value="10">
    Theta 1 :<input id=Theta1 size=20 value="10"> Theta 2 :<input id=Theta2 size=20 value="10">
    <input type=submit>
   </form> 
  
  <canvas  style="border:1px black solid" id="myCanvas"></canvas>

<script>
  //Ce formulaire sert à mettre tous les champs "input" -EN HAUT-

$('#set_variables_form').submit(function (e) { //cette fonction n'a pas de nom, elle sert juste à récuperer en JS les valeurs du formulaire
  e.preventDefault();
  console.log($('#mass1').val());
  m1       = $('#mass1').val();
  m2       = $('#mass2').val();
  Theta1   = $('#Theta1').val()/180*(Math.PI);
  Theta2   = $('#Theta2').val()/180*(Math.PI);
  d2Theta1 = 0;
  d2Theta2 = 0;
  dTheta1  = 0;
  dTheta2  = 0;
  run();
});

function drawCircle(myCircle, context) {
  context.beginPath();
  context.arc(Math.floor(myCircle.x), Math.floor(myCircle.y), myCircle.mass, 0, 2 * Math.PI, false); //forme du rond
  context.fillStyle = '#114'; //couleur, remplissage et épaisseur 
  context.fill();
  context.lineWidth = 5;
  context.strokeStyle = 'blue';
  context.stroke();
}

function drawLine(myLine, context) {
  context.beginPath();
  //console.log(Math.floor(myLine.x0)+","+Math.floor(myLine.y0)+"-"+Math.floor(myLine.x)+","+Math.floor(myLine.y));
  context.moveTo(Math.floor(myLine.x0), Math.floor(myLine.y0));
  context.lineTo(Math.floor(myLine.x), Math.floor(myLine.y));
  context.strokeStyle = '#009';
  context.stroke();
}

function animate(myCircle1, myCircle2, myLine1, myLine2, canvas, context) {
  mu      =  1+m1/m2; //LAGRANGE OUIOUIOUI #coordonnées généralisées
  d2Theta1  =  (g*(Math.sin(Theta2)*Math.cos(Theta1-Theta2)-mu*Math.sin(Theta1))-(l2*dTheta2*dTheta2+l1*dTheta1*dTheta1*Math.cos(Theta1-Theta2))*Math.sin(Theta1-Theta2))/(l1*(mu-Math.cos(Theta1-Theta2)*Math.cos(Theta1-Theta2)));
  d2Theta2  =  (mu*g*(Math.sin(Theta1)*Math.cos(Theta1-Theta2)-Math.sin(Theta2))+(mu*l1*dTheta1*dTheta1+l2*dTheta2*dTheta2*Math.cos(Theta1-Theta2))*Math.sin(Theta1-Theta2))/(l2*(mu-Math.cos(Theta1-Theta2)*Math.cos(Theta1-Theta2)));
  dTheta1   += d2Theta1*time;
  dTheta2   += d2Theta2*time;
  Theta1    += dTheta1*time;
  Theta2    += dTheta2*time;
  //console.log(Theta1);

  myCircle1.x = X0+l1*Math.sin(Theta1); //coordonnées de mouvement des cercles grâce à LAGRANGE
  myCircle1.y = Y0+l1*Math.cos(Theta1);
  myCircle2.x = X0+l1*Math.sin(Theta1)+l2*Math.sin(Theta2);
  myCircle2.y = Y0+l1*Math.cos(Theta1)+l2*Math.cos(Theta2);

  myLine1.x  = myCircle1.x; //REMARQUABLE : coordonnées de mouvement des lignes selon les coordonnées de mouvement des cercles
  myLine1.y  = myCircle1.y;
  myLine2.x0 = myCircle1.x;
  myLine2.y0 = myCircle1.y;
  myLine2.x  = myCircle2.x;
  myLine2.y  = myCircle2.y;

  context.clearRect(0, 0, canvas.width, canvas.height); //animation = après avoir fait le calcul pour t+1, on nettoie le canvas de t...

  drawLine(myLine1, context); //...et on dessine t+1
  drawLine(myLine2, context);
  drawCircle(myCircle1, context);
  drawCircle(myCircle2, context);
}

//Constantes physiques
var d2Theta1 = 0; 
var d2Theta2 = 0;
var dTheta1  = 0;
var dTheta2  = 0;
var Theta1   = 0*(Math.PI)/2;
var Theta2   = 2.3*(Math.PI)/2;
var m2     = 10;
var l1     = 150;
var l2     = 150;
var X0     = 350;
var Y0     = 60;
var g      = 9.8;
var time   = 0.1;

var canvas  = document.getElementById('myCanvas');
var context = canvas.getContext('2d');
var init    = {};
canvas.width = 750;
canvas.height = 500;


function run(){
  var myLine1 = {x0: X0, y0: Y0, x: 0, y: 0};
  var myLine2 = {x0: 0, y0: 0, x: 0, y: 0};
  var myCircle1 = {x: X0+l1*Math.sin(Theta1), y: Y0+l1*Math.cos(Theta1), mass: m1};
  var myCircle2 = {x: X0+l1*Math.sin(Theta1)+l2*Math.sin(Theta2), y: Y0+l1*Math.cos(Theta1)+l2*Math.cos(Theta2), mass: m2};

  clearInterval(init);
  context.clearRect(0, 0, canvas.width, canvas.height);
  init = setInterval(function(){
    animate(myCircle1, myCircle2, myLine1, myLine2, canvas, context);
  }, 5); //remet à zéro la simulation
}
</script>

  </body>
</html>

</html>
